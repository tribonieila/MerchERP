{{extend 'layout.html'}}
<div class="col-md-12">
  <div class="card card-underline">
      <div class="card-head">
      {{ _usr = db(db.Sales_Manager_User.user_id == auth.user_id).select().first() }}
      <ul class="nav nav-tabs pull-right" data-toggle="tabs">
        {{if not _usr:}}
        <li><a href="#first2">Stock Request</a></li>
        <li class="active"><a href="#second2">Sales Order <span class="badge style-warning">{{=db((db.Sales_Order.status_id == 4) & (db.Sales_Order.dept_code_id != 3) & (db.Sales_Order.cancelled == False)).count()}}</span></a></li>
        <li><a href="#third2">Sales Return Request</a></li>
        <li><a href="#fourth2">Purchase Request</a></li>
        <li><a href="#fifth2">Obsolescence of Stocks</a></li>
        {{else:}}
        <li><a href="#first2">Stock Request <span class="badge style-accent">{{=db((db.Stock_Request.srn_status_id == 4) & (db.Stock_Request.dept_code_id == _usr.department_id)).count()}}</span></a></li>
        <li class="active"><a href="#second2">Sales Order <span class="badge style-warning">{{=db((db.Sales_Order.status_id == 4) & (db.Sales_Order.dept_code_id == _usr.department_id) & (db.Sales_Order.section_id == _usr.section_id) &(db.Sales_Order.cancelled == False)).count()}}</span></a></li>
        <li><a href="#third2">Sales Return Request <span class="badge style-warning">{{=db((db.Sales_Return.status_id == 4) & (db.Sales_Return.dept_code_id == _usr.department_id) & (db.Sales_Return.section_id == _usr.section_id)).count()}}</span></a></li>
        <li><a href="#fourth2">Purchase Request <span class="badge style-primary">{{=db((db.Purchase_Request.status_id == 19) & (db.Purchase_Request.dept_code_id == _usr.department_id) & (db.Purchase_Request.section_id == _usr.section_id)).count()}}</span></a></li>
        <li><a href="#fifth2">Obsolescence of Stocks <span class="badge style-accent">{{=db((db.Obsolescence_Stocks.status_id == 4) & (db.Obsolescence_Stocks.dept_code_id == _usr.department_id)).count()}}</span></a></li>
        <li><a href="#sixth2">Stocks Corrections <span class="badge style-accent">{{=db((db.Stock_Corrections.status_id == 4) & (db.Stock_Corrections.dept_code_id == _usr.department_id)).count()}}</span></a></li>
        {{pass}}
      </ul>      
      <span class="card-title">{{=auth.user.first_name.upper()}} {{=auth.user.last_name.upper()}} Workflow </span>
    </div>
    <div class="card-body tab-content">
      <div class="tab-pane" id="first2">
        {{=LOAD('inventory','stock_request_manager_grid.load')}}        
      </div>
      <div class="tab-pane active" id="second2">						
        {{=LOAD('sales','sales_order_manager_grid.load')}}        
      </div>
      <div class="tab-pane" id="third2">						
        {{=LOAD('sales','sales_return_grid.load')}}        
      </div>
      <div class="tab-pane" id="fourth2">						
        {{=LOAD('procurement','purchase_request_grid.load')}}
      </div>
      <div class="tab-pane" id="fifth2">						
        {{=LOAD('inventory','get_obsolescence_of_stocks_workflow_grid.load')}} 
      </div>    
      <div class="tab-pane" id="sixth2">						
        {{=LOAD('inventory','stock_corrections.load')}}       
      </div>         
    </div>
  </div>


<script>

  function onRefresh(){
    location.reload();        
  }
</script>